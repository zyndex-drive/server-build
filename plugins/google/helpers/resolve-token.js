'use strict';var a153_0xff8c74=a153_0x1e68;(function(_0x419761,_0x100c17){var _0x4b9462=a153_0x1e68,_0x12b8bb=_0x419761();while(!![]){try{var _0xf556e3=-parseInt(_0x4b9462(0x20a))/0x1*(-parseInt(_0x4b9462(0x20f))/0x2)+-parseInt(_0x4b9462(0x1f3))/0x3+-parseInt(_0x4b9462(0x214))/0x4+-parseInt(_0x4b9462(0x1fb))/0x5*(parseInt(_0x4b9462(0x202))/0x6)+-parseInt(_0x4b9462(0x219))/0x7+parseInt(_0x4b9462(0x225))/0x8*(parseInt(_0x4b9462(0x21f))/0x9)+parseInt(_0x4b9462(0x1f6))/0xa;if(_0xf556e3===_0x100c17)break;else _0x12b8bb['push'](_0x12b8bb['shift']());}catch(_0x154b81){_0x12b8bb['push'](_0x12b8bb['shift']());}}}(a153_0x5df7,0x34476));var __spreadArray=this&&this[a153_0xff8c74(0x1f5)]||function(_0x1744f6,_0x2b8592,_0x6a8709){var _0x1583bd=a153_0xff8c74;if(_0x6a8709||arguments[_0x1583bd(0x201)]===0x2)for(var _0x527efa=0x0,_0x4c5f5d=_0x2b8592['length'],_0x3bccd2;_0x527efa<_0x4c5f5d;_0x527efa++){if(_0x3bccd2||!(_0x527efa in _0x2b8592)){if(!_0x3bccd2)_0x3bccd2=Array[_0x1583bd(0x211)][_0x1583bd(0x1fa)]['call'](_0x2b8592,0x0,_0x527efa);_0x3bccd2[_0x527efa]=_0x2b8592[_0x527efa];}}return _0x1744f6[_0x1583bd(0x20e)](_0x3bccd2||Array[_0x1583bd(0x211)]['slice'][_0x1583bd(0x221)](_0x2b8592));};Object['defineProperty'](exports,a153_0xff8c74(0x213),{'value':!![]});var _models_1=require('../../../models'),generate_token_1=require('../../google/handlers/nac/generate-token'),generate_token_2=require('../../google/handlers/sac/generate-token'),misc_1=require('../../misc');function getAllTokens(_0x147566,_0x3f1ef0){return new Promise(function(_0x6045bb,_0x1aec99){var _0x4cef43=a153_0x1e68,_0x1970fb={'success':![]};_models_1[_0x4cef43(0x218)][_0x4cef43(0x21b)](_0x147566)['then'](function(_0x544a24){var _0x9da1d6=_0x4cef43;_0x544a24&&(_0x1970fb['credential']=_0x544a24,_models_1['ServiceAccs'][_0x9da1d6(0x21c)]({'related_to':_0x544a24[_0x9da1d6(0x207)]})[_0x9da1d6(0x222)](function(_0x3d437f){var _0x537c61=_0x9da1d6;_0x1970fb[_0x537c61(0x220)]=_0x3d437f;var _0x35d732=_0x3d437f[_0x537c61(0x223)](function(_0x3afbf7){return _0x3afbf7['_id'];}),_0xf14da8=__spreadArray([{'related_to':_0x544a24[_0x537c61(0x207)],'scopes':_0x3f1ef0}],_0x35d732[_0x537c61(0x223)](function(_0x5ed8ce){return{'related_to':_0x5ed8ce,'scopes':_0x3f1ef0};}),!![]);_models_1['Tokens'][_0x537c61(0x21c)]({'$or':_0xf14da8})[_0x537c61(0x222)](function(_0x297502){var _0x2a2693=_0x537c61;if(_0x297502[_0x2a2693(0x201)]>0x0){var _0x42708b=_0x297502[_0x2a2693(0x209)](function(_0x267dbf){var _0x358654=_0x2a2693;return _0x267dbf[_0x358654(0x217)]===_0x358654(0x1ff)&&_0x267dbf[_0x358654(0x208)]===_0x358654(0x1f4);}),_0x1459f1=_0x297502[_0x2a2693(0x209)](function(_0x4d10b7){var _0x47ab94=_0x2a2693;return _0x4d10b7[_0x47ab94(0x217)]===_0x47ab94(0x1ff)&&_0x4d10b7['ref_model']==='ServiceAccount';}),_0x79146=_0x297502[_0x2a2693(0x209)](function(_0x3da6c3){var _0x20e2a9=_0x2a2693;return _0x3da6c3[_0x20e2a9(0x217)]===_0x20e2a9(0x204);});_0x1970fb[_0x2a2693(0x224)]={'access':{'normal':_0x42708b,'service':_0x1459f1},'refresh':_0x79146},_0x1970fb['success']=!![],_0x6045bb(_0x1970fb);}else _0x1970fb[_0x2a2693(0x1f2)]=![],_0x6045bb(_0x1970fb);})[_0x537c61(0x21a)](function(_0x372d19){var _0x3a5335=_0x537c61;_0x1aec99(new Error(''[_0x3a5335(0x20e)](_0x372d19[_0x3a5335(0x210)],':\x20')['concat'](_0x372d19[_0x3a5335(0x21e)])));});})['catch'](function(_0x51a9c8){var _0xc7e5a0=_0x9da1d6;_0x1aec99(new Error(''[_0xc7e5a0(0x20e)](_0x51a9c8['name'],':\x20')[_0xc7e5a0(0x20e)](_0x51a9c8[_0xc7e5a0(0x21e)])));}));})['catch'](function(_0x2f6b36){var _0x235581=_0x4cef43;_0x1aec99(new Error(''[_0x235581(0x20e)](_0x2f6b36[_0x235581(0x210)],':\x20')[_0x235581(0x20e)](_0x2f6b36[_0x235581(0x21e)])));});});}function checkValidity(_0x27a493){var _0x3fad67=a153_0xff8c74,_0x23939b=_0x27a493[_0x3fad67(0x223)](function(_0x6c5d21){var _0xe318fb=_0x3fad67,_0x131d28=Date[_0xe318fb(0x20b)]()+0xf*0x3c*0x3e8,_0x3b3eb3=_0x6c5d21[_0xe318fb(0x203)],_0x418b2c={'token':_0x6c5d21,'validity':![]};return _0x3b3eb3>_0x131d28&&(_0x418b2c[_0xe318fb(0x206)]=!![]),_0x418b2c;});return _0x23939b;}function a153_0x1e68(_0x112e36,_0x3557e8){var _0x5df76b=a153_0x5df7();return a153_0x1e68=function(_0x1e681d,_0x4570e8){_0x1e681d=_0x1e681d-0x1f0;var _0x4d3c07=_0x5df76b[_0x1e681d];return _0x4d3c07;},a153_0x1e68(_0x112e36,_0x3557e8);}function deleteInvalidTokens(_0x13c3d1){return new Promise(function(_0x23d6c9,_0x26cf10){var _0xc8cf3f=a153_0x1e68,_0x4f88fe=_0x13c3d1[_0xc8cf3f(0x223)](function(_0x3cbce2){var _0x3bb4b6=_0xc8cf3f;return _0x3cbce2[_0x3bb4b6(0x207)];});_models_1[_0xc8cf3f(0x1f9)][_0xc8cf3f(0x1fd)]({'_id':{'$in':_0x4f88fe}})[_0xc8cf3f(0x222)](function(){return _0x23d6c9();})[_0xc8cf3f(0x21a)](function(_0x41367f){var _0x23adb7=_0xc8cf3f;_0x26cf10(new Error(''[_0x23adb7(0x20e)](_0x41367f[_0x23adb7(0x210)],':\x20')[_0x23adb7(0x20e)](_0x41367f[_0x23adb7(0x21e)])));});});}function generateNormalTokenSave(_0x3d44f8,_0x52e342,_0x145ab0){return new Promise(function(_0x31fbbc,_0x1cfe41){var _0x591b62=a153_0x1e68;(0x0,generate_token_1[_0x591b62(0x215)])(_0x3d44f8,_0x145ab0[_0x591b62(0x205)])[_0x591b62(0x222)](function(_0xa00960){var _0x219519=_0x591b62,_0x438a16=(0x0,misc_1[_0x219519(0x216)])('t'),_0x5e5fdf=Date['now'](),_0x272316={'_id':_0x438a16,'token':_0xa00960[_0x219519(0x212)],'type':_0x219519(0x1ff),'related_to':_0x3d44f8[_0x219519(0x207)],'scopes':_0x52e342,'ref_model':_0x219519(0x1f4),'expires_at':_0x5e5fdf+_0xa00960['expires_in']*0x3e8,'website':_0x219519(0x1f1)};_models_1[_0x219519(0x1f9)][_0x219519(0x20d)](_0x272316)['then'](function(_0x78b5f1){_0x31fbbc(_0x78b5f1);})[_0x219519(0x21a)](function(_0x25561c){var _0x59b92d=_0x219519;_0x1cfe41(new Error(''[_0x59b92d(0x20e)](_0x25561c['name'],':\x20')[_0x59b92d(0x20e)](_0x25561c[_0x59b92d(0x21e)])));});})[_0x591b62(0x21a)](function(_0x314dc7){_0x1cfe41(new Error(_0x314dc7));});});}function generateServiceTokenSave(_0x39f80c,_0x17c962){return new Promise(function(_0x588f81,_0x5b1a7e){var _0x547f62=a153_0x1e68;(0x0,generate_token_2['generateAccessToken'])(_0x39f80c,_0x17c962)[_0x547f62(0x222)](function(_0x2b3a6a){var _0x398b0f=_0x547f62,_0x2fee69=(0x0,misc_1[_0x398b0f(0x216)])('t'),_0x43fd80=Date[_0x398b0f(0x20b)](),_0x3bde45={'_id':_0x2fee69,'token':_0x2b3a6a['access_token'],'type':_0x398b0f(0x1ff),'related_to':_0x39f80c[_0x398b0f(0x207)],'scopes':_0x17c962,'ref_model':'ServiceAccount','expires_at':_0x43fd80+_0x2b3a6a[_0x398b0f(0x1f0)]*0x3e8,'website':_0x398b0f(0x1f1)};_models_1[_0x398b0f(0x1f9)][_0x398b0f(0x20d)](_0x3bde45)['then'](function(_0xd94f57){_0x588f81(_0xd94f57);})[_0x398b0f(0x21a)](function(_0x3fdb8d){var _0x136904=_0x398b0f;_0x5b1a7e(new Error(''['concat'](_0x3fdb8d[_0x136904(0x210)],':\x20')[_0x136904(0x20e)](_0x3fdb8d[_0x136904(0x21e)])));});})[_0x547f62(0x21a)](function(_0x411814){_0x5b1a7e(new Error(_0x411814));});});}function serviceAccountTokenHandler(_0x450a82,_0x41b4b3){return new Promise(function(_0x9c8f88,_0x3b64bc){var _0x522993=a153_0x1e68,_0x391c26=_0x450a82[_0x522993(0x220)];if(_0x391c26){var _0x29e780=_0x450a82[_0x522993(0x224)];if(_0x29e780&&_0x29e780[_0x522993(0x1ff)][_0x522993(0x1f8)]){var _0x460d01=checkValidity(_0x29e780[_0x522993(0x1ff)]['service']),_0x386ed8=_0x460d01[_0x522993(0x209)](function(_0x4348e2){var _0xc85628=_0x522993;return _0x4348e2[_0xc85628(0x206)];})[_0x522993(0x223)](function(_0x1159f6){return _0x1159f6['token'];}),_0x18c5cc=_0x460d01[_0x522993(0x209)](function(_0x160738){var _0x46ae3d=_0x522993;return!_0x160738[_0x46ae3d(0x206)];})['map'](function(_0x3dbd9f){var _0x229b01=_0x522993;return _0x3dbd9f[_0x229b01(0x205)];});deleteInvalidTokens(_0x18c5cc)[_0x522993(0x222)](function(){var _0x39df5d=_0x522993;if(_0x386ed8[_0x39df5d(0x201)]>0x0)_0x9c8f88(_0x386ed8);else{var _0x30507b=[];_0x391c26['forEach'](function(_0x52e5e7){var _0x1e622d=_0x39df5d;generateServiceTokenSave(_0x52e5e7,_0x41b4b3)['then'](function(_0x18f3a4){var _0x4784c2=a153_0x1e68;_0x30507b[_0x4784c2(0x21d)](_0x18f3a4);})[_0x1e622d(0x21a)](function(_0x158964){var _0x589a85=_0x1e622d;_0x3b64bc(new Error(''['concat'](_0x158964[_0x589a85(0x210)],':\x20')[_0x589a85(0x20e)](_0x158964[_0x589a85(0x21e)])));});}),_0x30507b['length']>0x1?_0x9c8f88(_0x30507b):_0x9c8f88(![]);}})['catch'](function(_0x21b5d9){_0x3b64bc(new Error(_0x21b5d9));});}else{var _0x177c2a=[];_0x391c26[_0x522993(0x1f7)](function(_0x153006){var _0x3c3fca=_0x522993;generateServiceTokenSave(_0x153006,_0x41b4b3)[_0x3c3fca(0x222)](function(_0x190562){_0x177c2a['push'](_0x190562);})[_0x3c3fca(0x21a)](function(_0x5dc9c4){var _0x5a2acf=_0x3c3fca;_0x3b64bc(new Error(''[_0x5a2acf(0x20e)](_0x5dc9c4['name'],':\x20')[_0x5a2acf(0x20e)](_0x5dc9c4['message'])));});}),_0x177c2a[_0x522993(0x201)]>0x1?_0x9c8f88(_0x177c2a):_0x9c8f88(![]);}}else _0x9c8f88(![]);});}function checkTokenRefreshit(_0x577540,_0x37de88){return new Promise(function(_0x3a9d13,_0x3836f1){var _0x5ca509=a153_0x1e68,_0x83afc5=_0x577540[_0x5ca509(0x1f2)],_0x56cc90=_0x577540['credential'],_0xd2e1f1=_0x577540[_0x5ca509(0x220)],_0x3fe82a=_0x577540[_0x5ca509(0x224)];if(_0x83afc5&&_0x56cc90&&_0x3fe82a){var _0x252d3b=_0x3fe82a[_0x5ca509(0x1ff)],_0x262895=_0x3fe82a[_0x5ca509(0x204)];if(_0x262895[_0x5ca509(0x201)]>0x0){var _0x472fb7={'success':![],'credential':_0x56cc90,'serviceAcc':_0xd2e1f1};if(_0x252d3b['normal'][_0x5ca509(0x201)]===0x0)generateNormalTokenSave(_0x56cc90,_0x37de88,_0x262895[0x0])[_0x5ca509(0x222)](function(_0x1a5990){var _0x5e13d0=_0x5ca509;_0x472fb7[_0x5e13d0(0x1f2)]=![],_0x472fb7[_0x5e13d0(0x224)]={'refresh':_0x262895,'access':{'normal':[_0x1a5990]}},_0x3a9d13(_0x472fb7);})[_0x5ca509(0x21a)](function(_0x10234d){_0x3836f1(new Error(_0x10234d));});else{var _0x4d7b56=checkValidity(_0x252d3b[_0x5ca509(0x20c)]),_0x273514=_0x4d7b56['filter'](function(_0xb47774){var _0x481f41=_0x5ca509;return _0xb47774[_0x481f41(0x206)];})[_0x5ca509(0x223)](function(_0x488230){var _0x384da1=_0x5ca509;return _0x488230[_0x384da1(0x205)];}),_0x3bae47=_0x4d7b56['filter'](function(_0x353f98){var _0x3d797c=_0x5ca509;return!_0x353f98[_0x3d797c(0x206)];})[_0x5ca509(0x223)](function(_0x480388){var _0x179317=_0x5ca509;return _0x480388[_0x179317(0x205)];});deleteInvalidTokens(_0x3bae47)[_0x5ca509(0x222)](function(){var _0x43393c=_0x5ca509;_0x472fb7[_0x43393c(0x1f2)]=!![],_0x273514[_0x43393c(0x201)]>0x0?(_0x472fb7[_0x43393c(0x224)]={'refresh':_0x262895,'access':{'normal':_0x273514}},_0x3a9d13(_0x472fb7)):generateNormalTokenSave(_0x56cc90,_0x37de88,_0x262895[0x0])[_0x43393c(0x222)](function(_0x1139d4){_0x472fb7['tokens']={'refresh':_0x262895,'access':{'normal':[_0x1139d4]}},_0x3a9d13(_0x472fb7);})[_0x43393c(0x21a)](function(_0x527771){_0x3836f1(new Error(_0x527771));});})[_0x5ca509(0x21a)](function(_0x5e360a){var _0x2472b5=_0x5ca509;_0x3836f1(new Error(''['concat'](_0x5e360a[_0x2472b5(0x210)],':\x20')['concat'](_0x5e360a[_0x2472b5(0x21e)])));});}}else{var _0x4e6b40={'success':![]};_0x3a9d13(_0x4e6b40);}}else{var _0x4e6b40={'success':![]};_0x3a9d13(_0x4e6b40);}});}function default_1(_0x2faf9b,_0x249aef){return new Promise(function(_0x3876c7,_0x2925c6){var _0x20f3c2=a153_0x1e68;getAllTokens(_0x2faf9b,_0x249aef)[_0x20f3c2(0x222)](function(_0x4a980e){var _0x1bca43=_0x20f3c2;checkTokenRefreshit(_0x4a980e,_0x249aef)['then'](function(_0x44fdbc){var _0x5d0a12=a153_0x1e68;_0x44fdbc[_0x5d0a12(0x224)]?serviceAccountTokenHandler(_0x4a980e,_0x249aef)[_0x5d0a12(0x222)](function(_0x3fbd5e){var _0x254b6f=_0x5d0a12;if(_0x44fdbc[_0x254b6f(0x224)]){if(_0x3fbd5e){var _0x545341={'success':!![],'tokens':__spreadArray(__spreadArray([],_0x44fdbc[_0x254b6f(0x224)][_0x254b6f(0x1ff)]['normal'],!![]),_0x3fbd5e,!![])};_0x3876c7(_0x545341);}else{var _0x545341={'success':!![],'tokens':_0x44fdbc[_0x254b6f(0x224)][_0x254b6f(0x1ff)][_0x254b6f(0x20c)]};_0x3876c7(_0x545341);}}else _0x2925c6(new Error(_0x254b6f(0x1fc)));})[_0x5d0a12(0x21a)](function(){var _0x48a1ae=_0x5d0a12;_0x2925c6(new Error(_0x48a1ae(0x1fe)));}):_0x2925c6(new Error(_0x5d0a12(0x200)));})[_0x1bca43(0x21a)](function(_0x1a40eb){_0x2925c6(new Error(_0x1a40eb));});})['catch'](function(_0x49064f){_0x2925c6(_0x49064f);});});}function a153_0x5df7(){var _0x23df77=['Credentials','1285837tDUcoy','catch','findById','find','push','message','45GXyrfo','serviceAcc','call','then','map','tokens','333752JcLwev','expires_in','google.com','success','721824uwMhZz','Credential','__spreadArray','3771570zGFSiE','forEach','service','Tokens','slice','665DCrEnd','No\x20Possible\x20Tokens\x20Found\x20or\x20Generated','deleteMany','Error\x20While\x20Fetching\x20Service\x20Account\x20Tokens','access','No\x20Tokens\x20Found','length','7566JgsTBz','expires_at','refresh','token','validity','_id','ref_model','filter','14jkGwGd','now','normal','create','concat','37432kGSafW','name','prototype','access_token','__esModule','166520rXCRLE','generateAccessToken','objectID','type'];a153_0x5df7=function(){return _0x23df77;};return a153_0x5df7();}exports['default']=default_1;