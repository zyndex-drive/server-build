'use strict';var a141_0x51f388=a141_0x5352;(function(_0xefe1d2,_0x5927d4){var _0x4a4529=a141_0x5352,_0x38e24e=_0xefe1d2();while(!![]){try{var _0x3c532e=-parseInt(_0x4a4529(0x18c))/0x1*(-parseInt(_0x4a4529(0x1d3))/0x2)+parseInt(_0x4a4529(0x195))/0x3*(-parseInt(_0x4a4529(0x1b3))/0x4)+-parseInt(_0x4a4529(0x18f))/0x5*(parseInt(_0x4a4529(0x1a2))/0x6)+-parseInt(_0x4a4529(0x1ae))/0x7*(parseInt(_0x4a4529(0x1b7))/0x8)+parseInt(_0x4a4529(0x198))/0x9*(-parseInt(_0x4a4529(0x1c5))/0xa)+parseInt(_0x4a4529(0x1a6))/0xb*(-parseInt(_0x4a4529(0x1be))/0xc)+parseInt(_0x4a4529(0x1d0))/0xd;if(_0x3c532e===_0x5927d4)break;else _0x38e24e['push'](_0x38e24e['shift']());}catch(_0x179684){_0x38e24e['push'](_0x38e24e['shift']());}}}(a141_0x18c4,0x69b1f));function a141_0x18c4(){var _0x5202e4=['../../../google/helpers/API','8qwjBze','../../../crypto','query','default','objectID','&access_type=offline&state=','expires_in','8088ggJoOd','internalServerError','then','encrypt','message','value','state','20580ZMYEfV','str','authorize','call','&redirect_uri=','sent','Tokens','function','client_id','refresh','log','25689144cenFOS','../../../google/helpers/stringize-scope','__importDefault','2bYaNvh','throw','Error\x20Occured\x20while\x20Generating\x20a\x20UID','Query\x20Parameters','decrypt','label','Credential','done','822942IpwlQM','Generator\x20is\x20already\x20executing.','findById','10CKXsPU','insertMany','length','redirect_uri','now','__generator','144siDJgZ','all','catch','2556sAJVcJ','Credential\x20ID\x20Not\x20found\x20in\x20DB,\x20Kindly\x20Recheck','next','concat','refresh_token','okResponse','name','pop','../../../../models','_id','1418688XtmNPw','generateRefreshToken','__esModule','Token\x20Generation','4642PUhMsO','access','notFound','creds','return','No\x20Refresh\x20Token\x20Found\x20in\x20Response,\x20Kindly\x20Retry','google.com','client_id=','3284981yANcoz','ops','redirect','trys','badRequest','46252xJFUCN','push','Credentials'];a141_0x18c4=function(){return _0x5202e4;};return a141_0x18c4();}var __awaiter=this&&this['__awaiter']||function(_0x1bcfe2,_0x59dcd1,_0x284337,_0xa01ead){function _0x385261(_0x4e1f4a){return _0x4e1f4a instanceof _0x284337?_0x4e1f4a:new _0x284337(function(_0x3c7240){_0x3c7240(_0x4e1f4a);});}return new(_0x284337||(_0x284337=Promise))(function(_0x2d2c2a,_0x2beb61){var _0x4c4159=a141_0x5352;function _0x564af5(_0x36a822){var _0xa45da8=a141_0x5352;try{_0x3edd52(_0xa01ead[_0xa45da8(0x19a)](_0x36a822));}catch(_0x30416c){_0x2beb61(_0x30416c);}}function _0x4a8782(_0x5975f3){var _0xdab30e=a141_0x5352;try{_0x3edd52(_0xa01ead[_0xdab30e(0x185)](_0x5975f3));}catch(_0x31343d){_0x2beb61(_0x31343d);}}function _0x3edd52(_0x441513){var _0x5c0749=a141_0x5352;_0x441513[_0x5c0749(0x18b)]?_0x2d2c2a(_0x441513[_0x5c0749(0x1c3)]):_0x385261(_0x441513['value'])[_0x5c0749(0x1c0)](_0x564af5,_0x4a8782);}_0x3edd52((_0xa01ead=_0xa01ead['apply'](_0x1bcfe2,_0x59dcd1||[]))[_0x4c4159(0x19a)]());});},__generator=this&&this[a141_0x51f388(0x194)]||function(_0x297d5a,_0x3e92b6){var _0x4b535e=a141_0x51f388,_0x473aae={'label':0x0,'sent':function(){if(_0x41b3b0[0x0]&0x1)throw _0x41b3b0[0x1];return _0x41b3b0[0x1];},'trys':[],'ops':[]},_0x3570fa,_0x60f5c6,_0x41b3b0,_0x469286;return _0x469286={'next':_0x70025(0x0),'throw':_0x70025(0x1),'return':_0x70025(0x2)},typeof Symbol===_0x4b535e(0x1cc)&&(_0x469286[Symbol['iterator']]=function(){return this;}),_0x469286;function _0x70025(_0x517c0d){return function(_0x56eb08){return _0x40b97f([_0x517c0d,_0x56eb08]);};}function _0x40b97f(_0x4f1871){var _0x338d15=_0x4b535e;if(_0x3570fa)throw new TypeError(_0x338d15(0x18d));while(_0x473aae)try{if(_0x3570fa=0x1,_0x60f5c6&&(_0x41b3b0=_0x4f1871[0x0]&0x2?_0x60f5c6[_0x338d15(0x1aa)]:_0x4f1871[0x0]?_0x60f5c6[_0x338d15(0x185)]||((_0x41b3b0=_0x60f5c6['return'])&&_0x41b3b0[_0x338d15(0x1c8)](_0x60f5c6),0x0):_0x60f5c6[_0x338d15(0x19a)])&&!(_0x41b3b0=_0x41b3b0[_0x338d15(0x1c8)](_0x60f5c6,_0x4f1871[0x1]))[_0x338d15(0x18b)])return _0x41b3b0;if(_0x60f5c6=0x0,_0x41b3b0)_0x4f1871=[_0x4f1871[0x0]&0x2,_0x41b3b0[_0x338d15(0x1c3)]];switch(_0x4f1871[0x0]){case 0x0:case 0x1:_0x41b3b0=_0x4f1871;break;case 0x4:_0x473aae['label']++;return{'value':_0x4f1871[0x1],'done':![]};case 0x5:_0x473aae[_0x338d15(0x189)]++,_0x60f5c6=_0x4f1871[0x1],_0x4f1871=[0x0];continue;case 0x7:_0x4f1871=_0x473aae['ops'][_0x338d15(0x19f)](),_0x473aae['trys'][_0x338d15(0x19f)]();continue;default:if(!(_0x41b3b0=_0x473aae[_0x338d15(0x1b1)],_0x41b3b0=_0x41b3b0[_0x338d15(0x191)]>0x0&&_0x41b3b0[_0x41b3b0['length']-0x1])&&(_0x4f1871[0x0]===0x6||_0x4f1871[0x0]===0x2)){_0x473aae=0x0;continue;}if(_0x4f1871[0x0]===0x3&&(!_0x41b3b0||_0x4f1871[0x1]>_0x41b3b0[0x0]&&_0x4f1871[0x1]<_0x41b3b0[0x3])){_0x473aae[_0x338d15(0x189)]=_0x4f1871[0x1];break;}if(_0x4f1871[0x0]===0x6&&_0x473aae['label']<_0x41b3b0[0x1]){_0x473aae[_0x338d15(0x189)]=_0x41b3b0[0x1],_0x41b3b0=_0x4f1871;break;}if(_0x41b3b0&&_0x473aae[_0x338d15(0x189)]<_0x41b3b0[0x2]){_0x473aae[_0x338d15(0x189)]=_0x41b3b0[0x2],_0x473aae[_0x338d15(0x1af)][_0x338d15(0x1b4)](_0x4f1871);break;}if(_0x41b3b0[0x2])_0x473aae[_0x338d15(0x1af)][_0x338d15(0x19f)]();_0x473aae[_0x338d15(0x1b1)][_0x338d15(0x19f)]();continue;}_0x4f1871=_0x3e92b6[_0x338d15(0x1c8)](_0x297d5a,_0x473aae);}catch(_0xe6a457){_0x4f1871=[0x6,_0xe6a457],_0x60f5c6=0x0;}finally{_0x3570fa=_0x41b3b0=0x0;}if(_0x4f1871[0x0]&0x5)throw _0x4f1871[0x1];return{'value':_0x4f1871[0x0]?_0x4f1871[0x1]:void 0x0,'done':!![]};}},__importDefault=this&&this[a141_0x51f388(0x1d2)]||function(_0x565c6e){var _0x1c3feb=a141_0x51f388;return _0x565c6e&&_0x565c6e[_0x1c3feb(0x1a4)]?_0x565c6e:{'default':_0x565c6e};};Object['defineProperty'](exports,a141_0x51f388(0x1a4),{'value':!![]});var _models_1=require(a141_0x51f388(0x1a0)),API_1=__importDefault(require(a141_0x51f388(0x1b6))),misc_1=require('../../../misc'),crypto_1=require(a141_0x51f388(0x1b8)),generate_token_1=require('../../../google/handlers/nac/generate-token'),stringize_scope_1=__importDefault(require(a141_0x51f388(0x1d1))),responses_1=require('../../../../plugins/server/responses');function constructOauthURL(_0x3d66df,_0x5e872d,_0x536ce4){var _0x14e496=a141_0x51f388,_0x4ce60b=encodeURIComponent(_0x3d66df[_0x14e496(0x1cd)]),_0x40027d=encodeURIComponent(_0x3d66df[_0x14e496(0x192)]),_0xe14ac=encodeURIComponent(_0x536ce4),_0x5ef686=(0x0,stringize_scope_1[_0x14e496(0x1ba)])(_0x5e872d),_0x46729e=encodeURIComponent(_0x5ef686),_0x26f9d0=_0x14e496(0x1ad)[_0x14e496(0x19b)](_0x4ce60b,_0x14e496(0x1c9))[_0x14e496(0x19b)](_0x40027d,'&response_type=code&scope=')['concat'](_0x46729e,_0x14e496(0x1bc))[_0x14e496(0x19b)](_0xe14ac);return''['concat'](API_1[_0x14e496(0x1ba)][_0x14e496(0x1c7)],'?')[_0x14e496(0x19b)](_0x26f9d0);}function redirectUser(_0x10d4cb,_0x14f20a,_0x4dcc61){var _0x1fd3b3=a141_0x51f388;_models_1[_0x1fd3b3(0x1b5)][_0x1fd3b3(0x18e)](_0x14f20a)['then'](function(_0x24f089){var _0x24b506=_0x1fd3b3;if(_0x24f089){var _0x2a5606=crypto_1[_0x24b506(0x1c1)][_0x24b506(0x1c6)](String(_0x24f089[_0x24b506(0x1a1)])),_0x40c9c4=constructOauthURL(_0x24f089,_0x4dcc61,_0x2a5606);_0x10d4cb[_0x24b506(0x1b0)](_0x40c9c4);}else(0x0,responses_1['notFound'])(_0x10d4cb,_0x24b506(0x199));})[_0x1fd3b3(0x197)](function(_0x1f42ea){var _0x48a611=_0x1fd3b3;(0x0,responses_1[_0x48a611(0x1bf)])(_0x10d4cb,_0x1f42ea[_0x48a611(0x19e)],_0x1f42ea[_0x48a611(0x1c2)]);});}function handleTokenSaving(_0x46f246,_0x2ba82c,_0xd648e0,_0x4ec618){return new Promise(function(_0xeb4f63,_0x43a569){var _0x2dce3a=a141_0x5352,_0x451b58=Date[_0x2dce3a(0x193)]();Promise[_0x2dce3a(0x196)]([(0x0,misc_1[_0x2dce3a(0x1bb)])('t'),(0x0,misc_1[_0x2dce3a(0x1bb)])('t')])[_0x2dce3a(0x1c0)](function(_0x45f7c5){var _0x268359=_0x2dce3a,_0x41c577=_0x45f7c5[0x0],_0x4e52b9=_0x45f7c5[0x1],_0x30f564=[{'_id':_0x41c577,'token':crypto_1['encrypt']['str'](_0xd648e0[_0x268359(0x19c)]),'type':_0x268359(0x1ce),'related_to':_0x46f246['_id'],'scopes':_0x2ba82c,'ref_model':_0x268359(0x18a),'expires_at':_0x451b58+0x64*0x16d*0x18*0xe10*0x3e8,'website':_0x268359(0x1ac)},{'_id':_0x4e52b9,'token':crypto_1[_0x268359(0x1c1)][_0x268359(0x1c6)](_0x4ec618['access_token']),'type':_0x268359(0x1a7),'related_to':_0x46f246[_0x268359(0x1a1)],'scopes':_0x2ba82c,'ref_model':'Credential','expires_at':_0x451b58+_0x4ec618[_0x268359(0x1bd)]*0x3e8,'website':_0x268359(0x1ac)}];_models_1[_0x268359(0x1cb)][_0x268359(0x190)](_0x30f564)[_0x268359(0x1c0)](function(_0x459924){_0xeb4f63(_0x459924);})[_0x268359(0x197)](function(_0x4a42ad){var _0x43c74d=_0x268359;_0x43a569(new Error(''['concat'](_0x4a42ad['name'],':\x20')['concat'](_0x4a42ad[_0x43c74d(0x1c2)])));});})[_0x2dce3a(0x197)](function(_0x356b70){var _0x3005e6=_0x2dce3a;console[_0x3005e6(0x1cf)](_0x356b70),_0x43a569(new Error(_0x3005e6(0x186)));});});}function a141_0x5352(_0x3c7d1a,_0x5a3f9f){var _0x18c409=a141_0x18c4();return a141_0x5352=function(_0x535207,_0x38c132){_0x535207=_0x535207-0x185;var _0x1bd23c=_0x18c409[_0x535207];return _0x1bd23c;},a141_0x5352(_0x3c7d1a,_0x5a3f9f);}function handleUserAuthorization(_0x43a47c,_0x146024,_0x1e9f66,_0x4ef9bc){var _0x163c57=a141_0x51f388,_0x21ea80=this;_models_1['Credentials'][_0x163c57(0x18e)](_0x146024)[_0x163c57(0x1c0)](function(_0x2b1078){return __awaiter(_0x21ea80,void 0x0,void 0x0,function(){var _0x30c876,_0xa5f527,_0x599979,_0x5253ae,_0x36896e;return __generator(this,function(_0x2b9304){var _0x4b678c=a141_0x5352;switch(_0x2b9304[_0x4b678c(0x189)]){case 0x0:if(!_0x2b1078)return[0x3,0x9];_0x30c876=(0x0,stringize_scope_1[_0x4b678c(0x1ba)])(_0x4ef9bc),_0x2b9304['label']=0x1;case 0x1:_0x2b9304['trys'][_0x4b678c(0x1b4)]([0x1,0x7,,0x8]);return[0x4,(0x0,generate_token_1[_0x4b678c(0x1a3)])(_0x2b1078,_0x30c876,_0x1e9f66)];case 0x2:_0xa5f527=_0x2b9304[_0x4b678c(0x1ca)]();if(!_0xa5f527[_0x4b678c(0x19c)])return[0x3,0x5];return[0x4,(0x0,generate_token_1['generateAccessToken'])(_0x2b1078,_0xa5f527[_0x4b678c(0x19c)])];case 0x3:_0x599979=_0x2b9304[_0x4b678c(0x1ca)]();return[0x4,handleTokenSaving(_0x2b1078,_0x4ef9bc,_0xa5f527,_0x599979)];case 0x4:_0x5253ae=_0x2b9304[_0x4b678c(0x1ca)](),(0x0,responses_1[_0x4b678c(0x19d)])(_0x43a47c,_0x5253ae);return[0x3,0x6];case 0x5:throw new Error(_0x4b678c(0x1ab));case 0x6:return[0x3,0x8];case 0x7:_0x36896e=_0x2b9304['sent'](),console[_0x4b678c(0x1cf)](_0x36896e),(0x0,responses_1['internalServerError'])(_0x43a47c,_0x4b678c(0x1a5),String(_0x36896e));return[0x3,0x8];case 0x8:return[0x3,0xa];case 0x9:(0x0,responses_1[_0x4b678c(0x1a8)])(_0x43a47c,_0x4b678c(0x199)),_0x2b9304[_0x4b678c(0x189)]=0xa;case 0xa:return[0x2];}});});})['catch'](function(_0x12158e){var _0x16a252=_0x163c57;(0x0,responses_1[_0x16a252(0x1bf)])(_0x43a47c,_0x12158e[_0x16a252(0x19e)],_0x12158e['message']);});}function default_1(_0x26714c,_0x5dec19,_0x312639){var _0x2d3f50=a141_0x51f388,_0xb95569=_0x26714c[_0x2d3f50(0x1b9)],_0x50b639=_0xb95569[_0x2d3f50(0x1a9)],_0x4966af=_0xb95569['code'],_0x3b95da=_0xb95569[_0x2d3f50(0x1c4)];console[_0x2d3f50(0x1cf)](_0x4966af,_0x50b639,String(_0x3b95da));if(!_0x4966af&&_0x50b639)redirectUser(_0x5dec19,String(_0x50b639),_0x312639);else{if(_0x4966af&&_0x3b95da){var _0xbe1ff=String(_0x4966af),_0x4e888b=crypto_1[_0x2d3f50(0x188)][_0x2d3f50(0x1c6)](decodeURIComponent(String(_0x3b95da)));handleUserAuthorization(_0x5dec19,_0x4e888b,_0xbe1ff,_0x312639);}else(0x0,responses_1[_0x2d3f50(0x1b2)])(_0x5dec19,_0x2d3f50(0x1a9),_0x2d3f50(0x187));}}exports['default']=default_1;